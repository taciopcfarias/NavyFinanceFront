<h2>Dashboard</h2>

<section style="display:flex; gap:12px; align-items:end; margin: 12px 0; flex-wrap: wrap;">
  <div>
    <label>Data in√≠cio</label><br />
    <input type="date" [(ngModel)]="dataInicio">
  </div>

  <div>
    <label>Data fim</label><br />
    <input type="date" [(ngModel)]="dataFim">
  </div>

  <div>
    <label>Sa√≠das por categoria (relat√≥rio)</label><br />
    <select [(ngModel)]="categoriaSaida">
      <option *ngFor="let c of categoriasSaida" [value]="c.value">
        {{ c.label }}
      </option>
    </select>
  </div>

  <button (click)="carregar()">Atualizar</button>

  <button type="button" (click)="limparCategoria()" style="background:#f3f3f3; border:1px solid #ccc;">
    Limpar categoria
  </button>
</section>

<p *ngIf="carregando">Carregando...</p>
<p *ngIf="erro" style="color:red;">{{ erro }}</p>

<!-- CARDS (GERAIS DO PER√çODO - N√ÉO MUDAM COM CATEGORIA) -->
<div *ngIf="totais" style="display:flex; gap:20px; flex-wrap:wrap; margin-top:20px;">
  <div style="padding:16px; border:1px solid #ddd; min-width:200px;">
    <strong>üí∞ Entradas</strong><br />
    {{ totais.totalEntrada | currency:'BRL' }}
  </div>

  <div style="padding:16px; border:1px solid #ddd; min-width:200px;">
    <strong>üí∏ Sa√≠das</strong><br />
    {{ totais.totalSaida | currency:'BRL' }}
  </div>

  <div style="padding:16px; border:1px solid #ddd; min-width:200px;">
    <strong>üßÆ Saldo</strong><br />
    {{ totais.saldo | currency:'BRL' }}
  </div>
</div>

<!-- GR√ÅFICO -->
<div style="margin-top:24px; border:1px solid #ddd; padding:16px;">
  <h3>
    Entradas x Sa√≠das (Mensal)
    <span *ngIf="categoriaSaida">‚Äî Categoria: {{ categoriaSaida }}</span>
  </h3>
  <canvas id="graficoFinanceiro"></canvas>
</div>

<!-- ‚úÖ RELAT√ìRIO / TABELA -->
<div style="margin-top:24px; border:1px solid #ddd; padding:16px;">
  <h3>
    Relat√≥rio de Sa√≠das
    <span *ngIf="categoriaSaida">‚Äî Categoria: {{ categoriaSaida }}</span>
  </h3>

    <p *ngIf="relatorio.length === 0">Nenhuma sa√≠da encontrada no per√≠odo.</p>

    <table *ngIf="relatorio.length > 0" style="width:100%; border-collapse:collapse; margin-top:12px;">

    <thead>
      <tr>
        <th style="border-bottom:1px solid #ddd; text-align:left; padding:8px;">Data</th>
        <th style="border-bottom:1px solid #ddd; text-align:left; padding:8px;">Categoria</th>
        <th style="border-bottom:1px solid #ddd; text-align:left; padding:8px;">Forma</th>
        <th style="border-bottom:1px solid #ddd; text-align:left; padding:8px;">Observa√ß√£o</th>
        <th style="border-bottom:1px solid #ddd; text-align:right; padding:8px;">Valor</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let m of relatorio">
        <td style="border-bottom:1px solid #eee; padding:8px;">{{ m.data | date:'dd/MM/yyyy' }}</td>
        <td style="border-bottom:1px solid #eee; padding:8px;">{{ m.categoria }}</td>
        <td style="border-bottom:1px solid #eee; padding:8px;">{{ m.formaPagamento }}</td>
        <td style="border-bottom:1px solid #eee; padding:8px;">{{ m.observacao }}</td>
        <td style="border-bottom:1px solid #eee; padding:8px; text-align:right;">
          {{ m.valor | currency:'BRL' }}
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr>
        <td colspan="4" style="padding:10px; text-align:right; font-weight:bold; border-top:2px solid #ddd;">
          Total do relat√≥rio:
        </td>
        <td style="padding:10px; text-align:right; font-weight:bold; border-top:2px solid #ddd;">
          {{ totalRelatorio | currency:'BRL' }}
        </td>
      </tr>
    </tfoot>
  </table>
</div>
